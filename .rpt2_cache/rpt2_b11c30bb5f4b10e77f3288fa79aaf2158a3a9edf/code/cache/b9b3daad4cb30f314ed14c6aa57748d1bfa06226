{
  "code": "import PopDialog from \"./PopDialog\";\r\nimport { Events } from \"../script/Events\";\r\nimport { Paper } from \"../script/Paper\";\r\nimport { CardUI } from \"../script/CardUI\";\r\nexport class GameScene extends Laya.Scene {\r\n    createChildren() {\r\n        super.createChildren();\r\n        this.loadScene(\"GameScene\");\r\n        this.popdialog = new PopDialog(this);\r\n        this.popdialog.loadScene(\"PopDialog\");\r\n        this.events = new Events();\r\n    }\r\n    onAwake() {\r\n        this.btn_next.on(Laya.Event.CLICK, this, this.nextTurn);\r\n        this.cardUIs = [];\r\n        for (let i = 0; i < 7; i++) {\r\n            let cardUI = new CardUI(i);\r\n            this.cardUIs.push(cardUI);\r\n        }\r\n        this.cardUIs[0].button = this.cardBtn1;\r\n        this.cardUIs[1].button = this.cardBtn2;\r\n        this.cardUIs[2].button = this.cardBtn3;\r\n        this.cardUIs[3].button = this.cardBtn4;\r\n        this.cardUIs[4].button = this.cardBtn5;\r\n        this.cardUIs[5].button = this.cardBtn6;\r\n        this.cardUIs[6].button = this.cardBtn7;\r\n        for (let i = 0; i < 7; i++) {\r\n            this.cardUIs[i].init();\r\n        }\r\n        this.cardTxt.on(Laya.Event.CLICK, this, this.onClickCard);\r\n        this.on(Laya.Event.CLICK, this, this.onClick);\r\n    }\r\n    onClickCard() {\r\n        CardUI.cardClicked = true;\r\n    }\r\n    onClick() {\r\n        if (!CardUI.cardClicked) {\r\n            CardUI.seletedIndex = -1;\r\n        }\r\n        if (CardUI.seletedIndex == -1) {\r\n            this.cardinfo.visible = false;\r\n        }\r\n        else {\r\n            this.cardinfo.visible = true;\r\n        }\r\n        for (let i = 0; i < this.cardUIs.length; i++) {\r\n            this.cardUIs[i].updateUI();\r\n        }\r\n        CardUI.cardClicked = false;\r\n    }\r\n    init(ifChinese) {\r\n        GameScene.ifChinses = ifChinese;\r\n        this.currentPaper = new Paper();\r\n        this.bestPaper = new Paper();\r\n        this.cardinfo.visible = false;\r\n        this.grade = 1;\r\n        this.season = 1;\r\n        this.money = 0;\r\n        this.enegy = 7;\r\n        this.score = 0;\r\n        this.paper = 0;\r\n        this.finalpaperpercent = 0;\r\n        this.paperpercent = 0;\r\n        this.ifPass = false;\r\n        this.p_ifgoal1.visible = false;\r\n        this.p_ifgoal2.visible = false;\r\n        this.p_ifgoal3.visible = false;\r\n        this.p_ifgoal4.visible = false;\r\n        this.health = 100;\r\n        this.conf = 100;\r\n        this.soc = 60;\r\n        this.love = 60;\r\n        this.mot = 60;\r\n        this.adv = 60;\r\n        if (ifChinese) {\r\n            this.s_bg.loadImage(\"test/bg-cn.png\");\r\n            this.c_grade.skin = \"comp/grade_cn.png\";\r\n            this.c_season.skin = \"comp/season_cn.png\";\r\n            this.btn_next.label = \"下一回合\";\r\n            this.btnDo.label = \"执行\";\r\n            this.btnDiscard.label = \"弃牌\";\r\n        }\r\n        else {\r\n            this.s_bg.loadImage(\"test/bg-en.png\");\r\n            this.c_grade.skin = \"comp/grade_en.png\";\r\n            this.c_season.skin = \"comp/season_en.png\";\r\n            this.btn_next.label = \"Next turn\";\r\n            this.btnDo.label = \"Do this\";\r\n            this.btnDiscard.label = \"Discard\";\r\n        }\r\n        this.updateUI();\r\n        this.alert(this.events.getInitEvent());\r\n    }\r\n    nextTurn() {\r\n        if (this.grade == 1 && this.season == 1) {\r\n            this.alert(this.events.getTeachInfo1());\r\n        }\r\n        this.season += 1;\r\n        if (this.season == 5) {\r\n            this.grade++;\r\n            this.season = 1;\r\n        }\r\n        if (this.grade == 9) {\r\n            this.endGame();\r\n        }\r\n        this.updateUI();\r\n    }\r\n    updateUI() {\r\n        this.c_grade.value = this.grade.toString();\r\n        this.c_season.value = this.season.toString();\r\n        this.l_score.text = this.score.toString();\r\n        this.l_paper.text = this.paper.toString();\r\n        this.l_fpp.text = this.finalpaperpercent.toString();\r\n        this.l_enegy.text = this.enegy.toString();\r\n        this.p_paperpercent.value = this.paperpercent;\r\n        this.p_health.value = this.health / 100;\r\n        this.p_conf.value = this.conf / 100;\r\n        this.p_soc.value = this.soc / 100;\r\n        this.p_love.value = this.love / 100;\r\n        this.p_mot.value = this.mot / 100;\r\n        this.p_adv.value = this.adv / 100;\r\n        if (this.checkWin()) {\r\n            this.endGame();\r\n        }\r\n    }\r\n    alert(events) {\r\n        for (let i = 0; i < events.length; i++) {\r\n            this.popdialog.init(events[i]);\r\n            this.popdialog.open();\r\n        }\r\n    }\r\n    checkWin() {\r\n        if (this.score >= 6) {\r\n            this.p_ifgoal1.visible = true;\r\n        }\r\n        if (this.paper >= 2) {\r\n            this.p_ifgoal2.visible = true;\r\n        }\r\n        if (this.finalpaperpercent >= 100) {\r\n            this.p_ifgoal3.visible = true;\r\n        }\r\n        if (this.ifPass) {\r\n            this.p_ifgoal4.visible = this.ifPass;\r\n        }\r\n        if (this.p_ifgoal1.visible && this.p_ifgoal2.visible && this.p_ifgoal3.visible && this.p_ifgoal4.visible) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    endGame() {\r\n        Laya.stage.removeChild(this);\r\n    }\r\n}\r\n",
  "references": [
    "C:/Users/huang/Documents/myLaya/ld46_KeepDoctorAlive/src/scene/PopDialog.ts",
    "C:/Users/huang/Documents/myLaya/ld46_KeepDoctorAlive/src/script/Events.ts",
    "C:/Users/huang/Documents/myLaya/ld46_KeepDoctorAlive/src/script/Paper.ts",
    "C:/Users/huang/Documents/myLaya/ld46_KeepDoctorAlive/src/script/CardUI.ts"
  ]
}
